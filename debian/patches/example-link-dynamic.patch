Description: Add --enable-examples-dynamic-linking for dynamically linking
 examples against libndpi.
Author: Ludovico Cavedon <cavedon@debian.org>

Index: ndpi/example/Makefile.am
===================================================================
--- ndpi.orig/example/Makefile.am
+++ ndpi/example/Makefile.am
@@ -4,7 +4,9 @@ AM_CPPFLAGS = -I$(top_srcdir)/src/includ
 AM_CFLAGS = @PTHREAD_CFLAGS@ # --coverage
 
 LDADD = $(top_builddir)/src/lib/libndpi.la @JSON_C_LIBS@ @PTHREAD_LIBS@ @PCAP_LIB@ @DL_LIB@ -lm
+if !EXAMPLES_DYNAMIC_LINK
 AM_LDFLAGS = -static @DL_LIB@
+endif
 
 ndpiReader_SOURCES = ndpiReader.c ndpi_util.c ndpi_util.h uthash.h
 
Index: ndpi/configure.seed
===================================================================
--- ndpi.orig/configure.seed
+++ ndpi/configure.seed
@@ -84,6 +84,11 @@ AS_IF([test "x$enable_json_c" != "xno"],
 
 AC_CHECK_LIB(pthread, pthread_setaffinity_np, AC_DEFINE_UNQUOTED(HAVE_PTHREAD_SETAFFINITY_NP, 1, [libc has pthread_setaffinity_np]))
 
+AC_ARG_ENABLE([examples-dynamic-linking],
+              [AS_HELP_STRING([--enable-examples-dynamic-linking],
+                              [dynamically link examples against libndpi (default is no)])])
+AM_CONDITIONAL(EXAMPLES_DYNAMIC_LINK, [test "x$enable_examples_dynamic_linking" = "xyes"])
+
 AC_CONFIG_FILES([Makefile src/lib/Makefile example/Makefile tests/Makefile libndpi.pc src/include/ndpi_define.h])
 AC_CONFIG_HEADERS(config.h)
 AC_SUBST(JSON_C_CFLAGS)
