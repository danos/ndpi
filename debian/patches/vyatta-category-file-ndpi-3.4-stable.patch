From e7e9aa7ba7e2a420bb9ed0bbea5ab6dd36f1c23a Mon Sep 17 00:00:00 2001
From: Subhajit Chatterjee <subhajit.chatterjee@cdot.in>
Date: Fri, 6 Nov 2020 09:58:22 +0000
Subject: [PATCH] new vyatta-category-file added for ndpi-3.4(stable)

---
 src/lib/ndpi_main.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/lib/ndpi_main.c b/src/lib/ndpi_main.c
index 4cbe722..0b42c1c 100644
--- a/src/lib/ndpi_main.c
+++ b/src/lib/ndpi_main.c
@@ -2715,9 +2715,13 @@ int ndpi_load_categories_file(struct ndpi_detection_module_struct *ndpi_str, con
 
     if(name) {
       category = strtok_r(NULL, "\t", &saveptr);
+      ndpi_protocol_category_t category_val = atoi(category);
+      if (category_val == 0)
+        category_val = ndpi_get_category_id(ndpi_str, category);
 
-      if(category) {
-	int rc = ndpi_load_category(ndpi_str, name, (ndpi_protocol_category_t) atoi(category));
+
+      if(category_val > 0) {
+       int rc = ndpi_load_category(ndpi_str, name, category_val);
 
 	if(rc >= 0)
 	  num++;
-- 
2.20.1

