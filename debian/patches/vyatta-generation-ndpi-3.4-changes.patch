From c9afb998c5a35117ec8ba1dcea39a1a108a5a524 Mon Sep 17 00:00:00 2001
From: Subhajit Chatterjee <subhajit.chatterjee@cdot.in>
Date: Thu, 5 Nov 2020 15:36:33 +0000
Subject: [PATCH] Added nDPI-3.4 related changes in Vyatta Generation Patch

---
 generation/applications_list.c | 8 ++++----
 generation/ndpi_show_name.c    | 4 ++--
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/generation/applications_list.c b/generation/applications_list.c
index 0332d8e..ed7399d 100644
--- a/generation/applications_list.c
+++ b/generation/applications_list.c
@@ -22,7 +22,7 @@ char *strlwr(const char *str)
 
 void show_categories(void)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	for (int i = NDPI_PROTOCOL_CATEGORY_UNSPECIFIED + 1;
@@ -45,7 +45,7 @@ void show_categories(void)
 
 void show_protocols(void)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	u_int num_protocols = ndpi_get_ndpi_num_supported_protocols(ndpi_info_mod);
@@ -67,7 +67,7 @@ void show_protocols(void)
 
 void show_mapping(void)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	u_int num_protocols = ndpi_get_ndpi_num_supported_protocols(ndpi_info_mod);
@@ -91,7 +91,7 @@ void show_mapping(void)
 
 void dump_protocols(void)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	ndpi_dump_protocols(ndpi_info_mod);
diff --git a/generation/ndpi_show_name.c b/generation/ndpi_show_name.c
index f243e19..cca6daf 100644
--- a/generation/ndpi_show_name.c
+++ b/generation/ndpi_show_name.c
@@ -25,7 +25,7 @@ char *strlwr(const char *str)
  */
 void show_type(char *type)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	int id = ndpi_get_category_id(ndpi_info_mod, type);
@@ -60,7 +60,7 @@ void show_type(char *type)
  */
 void show_name(char *name)
 {
-	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module();
+	struct ndpi_detection_module_struct *ndpi_info_mod = ndpi_init_detection_module(ndpi_no_prefs);
 	if (ndpi_info_mod == NULL) return;
 
 	int id = ndpi_get_protocol_id(ndpi_info_mod, name);
-- 
2.20.1

