Index: ndpi/Makefile.in
===================================================================
--- ndpi.orig/Makefile.in
+++ ndpi/Makefile.in
@@ -31,9 +31,15 @@ endif
 NDPI_SHARED=$(NDPI_LIBDIR)/libndpi-@PACKAGE_VERSION@.$(SHEXT)
 NDPI_STATIC=$(NDPI_LIBDIR)/libndpi.a
 
-JSON_HOME=example/third-party/json-c
-JSON_INC=-I$(JSON_HOME)
-JSON_LIB=$(JSON_HOME)/.libs/libjson-c.a
+HAS_JSON=$(shell pkg-config --exists json-c; echo $$?)
+ifeq ($(HAS_JSON), 0)
+    JSON_INC = $(shell pkg-config --cflags json-c)
+    JSON_LIB = $(shell pkg-config --libs json-c)
+else
+    JSON_HOME=example/third-party/json-c
+    JSON_INC=-I$(JSON_HOME)
+    JSON_LIB=$(JSON_HOME)/.libs/libjson-c.a
+endif
 
 
 all: $(NDPI_SHARED) $(READER)
@@ -52,11 +58,16 @@ $(NDPI_STATIC): $(OBJECTS)
 	ar rc $(NDPI_STATIC) $(OBJECTS)
 	$(RANLIB) $@
 
+ifeq ($(HAS_JSON),0)
 $(READER): $(NDPI_STATIC) $(JSON_LIB)
 	$(CC) $(CFLAGS) $(JSON_INC) @PCAP_INC@ example/ndpiReader.c -o $@ $(NDPI_STATIC) @PCAP_LIB@ $(JSON_LIB) $(LIBS)
 
 $(JSON_LIB):
 	cd $(JSON_HOME); ./autogen.sh; ./configure; make
+else
+$(READER): $(NDPI_SHARED) $(JSON_LIB)
+	$(CC) $(CFLAGS) $(JSON_INC) @PCAP_INC@ example/ndpiReader.c -o $@ @PCAP_LIB@ $(JSON_LIB) $(LIBS) -L lib -lndpi
+endif
 
 #$(READER): $(NDPI_SHARED) src/example/ndpiReader.c
 #	$(CC) $(CFLAGS) src/example/ndpiReader.c -o $@ $(NDPI_SHARED) $(LIBS)
@@ -71,4 +82,4 @@ uninstall:
 	rm -r @INSTALL_PREFIX@/include/ndpi*
 	rm -r @INSTALL_PREFIX@/lib/libndpi*
 	rm  @INSTALL_PREFIX@/bin/ndpiReader
-	
\ No newline at end of file
+	
